<!--all-customer-header-->
<div class="all-customer-header">
  <!---all-customer-header-main-->
  <div class="all-customer-header-main">
    <!---title-->
    <div class="title"> 
      <h2>Customers</h2>
    </div>
    <!---vendor-search-->
    <div class="all-customer-search" (click)="onClickSearchArea($event)">
      <button><i class="fa fa-search"></i></button>

      <form class="search-form" #searchForm=ngForm>
        <input #searchInput
               id="searchInput"
               class="tw"
               type="text"
               placeholder="Search in customers..."
               (focus)=handleFocus($event)
               name="searchTerm"
               autocomplete="off"
               ngModel
               required>
        <div *ngIf="isLoading" class="sk-fading-circle">
          <div class="sk-circle1 sk-circle"></div>
          <div class="sk-circle2 sk-circle"></div>
          <div class="sk-circle3 sk-circle"></div>
          <div class="sk-circle4 sk-circle"></div>
          <div class="sk-circle5 sk-circle"></div>
          <div class="sk-circle6 sk-circle"></div>
          <div class="sk-circle7 sk-circle"></div>
          <div class="sk-circle8 sk-circle"></div>
          <div class="sk-circle9 sk-circle"></div>
          <div class="sk-circle10 sk-circle"></div>
          <div class="sk-circle11 sk-circle"></div>
          <div class="sk-circle12 sk-circle"></div>
        </div>
      </form>

<!-- Suggestion View -->
      <ul id="auto-suggestion" class="auto-complete-box"
          [ngClass]="searchUsers.length > 0 && isOpen ? 'active' : ''">
        <li class="list-view" *ngFor="let data of searchUsers" (click)="onSelectItem(data)">
          <!-- <img class="img-thumb" [src]="data.images && data.images.length > 0 ? data.images[0] : '/assets/images/placeholder/test.png'" [alt]="data?.productName"> -->
          <div class="desc">
            <h3>{{data?.fullName}}</h3>
          </div>
          <div class="price">
            <h5>{{data?.username}}</h5>
            <p class="discount">
              <!-- {{data?.username}} -->
            </p>
          </div>
        </li>
      </ul>
    </div>
    <div class="all-customer-create-btn">
      <button (click)="exportPopUpShow()">Export</button>
    </div>
  </div>
</div>


<!---all-customer-main-->
<div class="all-customer-main">
  <!--all-customer-header-area-->
  <div class="all-customer-header-area">
    <div class="all-customer-header-left">
    </div>
    <div class="all-customer-header-right">
      <ul>

        <!-- <li><button>Date <i class="fa fa-caret-down"></i></button></li> -->
        <li class="date-filter">
          <mat-form-field class="mat-date-input-field" appearance="outline" (click)="picker.open()">
            <mat-label>Filter Date Range</mat-label>
            <mat-date-range-input [formGroup]="dataFormDateRange" [rangePicker]="picker" [max]="today">
              <input matStartDate formControlName="start" placeholder="Start date" readonly>
              <input matEndDate formControlName="end" placeholder="End date" readonly
                     (dateChange)="endChangeRegDateRange($event)">
            </mat-date-range-input>
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-date-range-picker #picker></mat-date-range-picker>

            <mat-error *ngIf="dataFormDateRange.controls.start.hasError('matStartDateInvalid')">Invalid start date </mat-error>
            <mat-error *ngIf="dataFormDateRange.controls.end.hasError('matEndDateInvalid')">Invalid end date </mat-error>
          </mat-form-field>
        </li>



        <li><button [matMenuTriggerFor]="customerSort">Sort <i class="fa fa-caret-down"></i></button></li>
        <mat-menu #customerSort="matMenu">
          <button mat-menu-item style="font-size: 14px; height: 40px;" (click)="sortData({createdAt: 1}, 1)" [class.dropdown-active]="activeSort === 1">Last
            Update (Oldest First)</button>
          <button mat-menu-item style="font-size: 14px; height: 40px;" (click)="sortData({createdAt: -1}, 2)" [class.dropdown-active]="activeSort === 2">Last
            Update
            (Newest First)</button>
            <!-- Need to fix params -->
          <button mat-menu-item style="font-size: 13px; height: 40px;" (click)="sortData({createdAt: 1}, 3)" [class.dropdown-active]="activeSort === 3">Amount Spent (High to low)</button>
          <button mat-menu-item style="font-size: 13px; height: 40px;" (click)="sortData({createdAt: 1}, 4)" [class.dropdown-active]="activeSort === 4">Amount Spent (Low to High)</button>
          <button mat-menu-item style="font-size: 13px; height: 40px;" (click)="sortData({checkouts: -1}, 5)" [class.dropdown-active]="activeSort === 5">Total Orders (High to low)</button>
          <button mat-menu-item style="font-size: 13px; height: 40px;" (click)="sortData({checkouts: 1}, 6)" [class.dropdown-active]="activeSort === 6">Total Orders (Low to High)</button>
          <button mat-menu-item style="font-size: 13px; height: 40px;" (click)="sortData({createdAt: 1}, 5)" [class.dropdown-active]="activeSort === 5">Last order date (High to low)</button>
          <button mat-menu-item style="font-size: 13px; height: 40px;" (click)="sortData({createdAt: 1}, 6)" [class.dropdown-active]="activeSort === 6">Last order date (Low to High)</button>
          <button mat-menu-item style="font-size: 13px; height: 40px;" (click)="sortData({createdAt: 1}, 5)" [class.dropdown-active]="activeSort === 5">Data Added as a customer (Oldest First)</button>
          <button mat-menu-item style="font-size: 13px; height: 40px;" (click)="sortData({createdAt: -1}, 6)" [class.dropdown-active]="activeSort === 6">Data Added as a customer (Newest First)</button>

        </mat-menu>
      </ul>
    </div>
  </div>


  <!---all-customer-table-area-->
  <div class="all-customer-table-area">
    <!---vendor-table-->
    <div class="all-customer-table">
      <!---table-head-->
      <div class="table-head">
        <div class="table-row">
          <div class="table-heading check">
            <mat-checkbox #matCheckbox class="mat-check" (change)="onAllSelectChange($event)" ></mat-checkbox>
          </div>
          <div class="table-heading name">
            <h3>Customer Name</h3>
          </div>
          <div class="table-heading name">
            <h3>Customer Number</h3>
          </div>
          <div class="table-heading tag">
            <h3>Tag</h3>
          </div>
          <div class="table-heading order-number">
            <h3>Number of Order</h3>
          </div>
          <div class="table-heading spent">
            <h3>Spent</h3>
          </div>
          <div class="table-heading subscribe">
            <h3>Subscribe</h3>
          </div>
          <div class="table-heading status">
            <h3>Status</h3>
          </div>
        </div>

      </div>

      <!---table-head-end-->
      <!---table-body-area-->
      <div class="table-body">
        <div class="table-row"
          *ngFor="let data of customers | paginate: { itemsPerPage: productsPerPage, currentPage: currentPage, totalItems: totalUsers }; let i = index">
          <div class="table-data check">
            <mat-checkbox class="mat-check" (ngModelChange)="onCheckChange($event, i, data._id)"  [(ngModel)]="data.select"></mat-checkbox>
          </div>
          <div class="table-data name">
            <div class="customer-info">
              <a [routerLink]="['../../','customer', data._id ]">{{data.fullName? data.fullName: 'No Name'}}</a>
            </div>
          </div>
          <div class="table-data name">
            <div class="customer-info">
              <a style="color: blue; text-decoration: underline;" [routerLink]="['../../','customer', data._id ]">{{data.phoneNo}}</a>
            </div>
          </div>
          <div class="table-data tag">

            <div class="confirm">
              <span><img [matTooltip]="data?.tag?.name" [src]="data.tag?.images ? data.tag?.images : '/assets/images/placeholder/test.png'" [alt]="data.tag?.name"></span>
            </div>
          </div>
          <div class="table-data order-number">
            <h3>{{data?.checkouts? data.checkouts.length : '0'}}</h3>
          </div>
          <div class="table-data spent">
            <h3>{{totalSpent(i)}} Tk</h3>
          </div>
          <div class="table-data subscribe">
            <button>Subscribed</button>
          </div>
          <div class="table-data status">
            <div *ngIf="data.status === 0"  class="active">
              <button>active</button>
            </div>
            <div *ngIf="data.status === 1" class="in-active">
              <button>Inactive</button>
            </div>
          </div>

        </div>
      </div>
      <!---table-body-area-end-->
    </div>
  </div>

</div>
<!---indicator-->
<div class="indicator-area">
  <div class="pagination-container">
    <pagination-controls class="product-pagination" [autoHide]="true" [maxSize]="15"
      (pageChange)="onPageChanged($event)">
    </pagination-controls>
  </div>
  <div class="indicator-right">
    <span>Showing {{currentPage*productsPerPage-productsPerPage+1}} to {{currentPage*productsPerPage <= totalUsers ?
        currentPage*productsPerPage : totalUsers}} of {{totalUsers}} entries</span>
  </div>
</div>
<div class="export-popup-area">
  <app-export-popup (valueChange)='exportToExcel($event)'  #export></app-export-popup>
</div>

<!-- NO DATA TEMPLATE -->
<ng-template #noData>
  <div style="margin-top: 50px; text-align: center">
    <h2>No Product Found</h2>
  </div>
</ng-template>
