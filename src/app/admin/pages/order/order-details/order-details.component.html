<div class="order-header-top">
  <!---order-title-->
  <div class="order-title">
    <h3>Order Details</h3>
  </div>
  <!---order-btn-area-->
  <div class="order-btn-area">
    <ul>
      <li><button>Import</button></li>
      <li><button>Export</button></li>
      <li>
        <button class="active-btn" (click)="openDialog2()">Create Order</button>
      </li>
    </ul>
  </div>
</div>
<!---order-details-right-side-bar-top-->


<!--order-details-->
<div class="order_details">

  <div class="order_details_left-sidebar">
    <div class="order-details-left-sidebar-top">
      <div class="order-details-left-top-dotted">
        <div>
          <button routerLink="/admin/regular-orders">
            All Order <i class="fa fa-angle-down"></i>
          </button>
        </div>
        <div class="dotted">
          <span><i class="fa-solid fa-ellipsis"></i></span>
        </div>
      </div>
      <!--search-->
      <div class="top-search-area">
        <div>
          <button><i class="fa fa-search"></i></button>
        </div>
        <div class="search-input">
          <input type="text" value="" placeholder="Search customer " />
        </div>
      </div>
    </div>
    <!---top-end-->
    <!---order-details-right-side-bar-main-->
    <div class="order-details-left-side-bar-main">
      <div class="order-details-sidebar-info">
        <ul>
          <li *ngFor="
              let data of orders
                | paginate
                  : {
                      itemsPerPage: ordersPerPage,
                      currentPage: currentPage,
                      totalItems: totalOrders
                    };
              let i = index
            " [class.active]="data?._id === id" [routerLink]="['../../', 'order-details', data._id]">
            <div class="sidebar-info-left">
              {{ data?.user?.fullName ? data?.user.fullName : data.user.phoneNo }}
              <span [routerLink]="['../../', 'order-details', data._id]">SO-{{ data?.orderId }}
                |
                <small>{{ data?.checkoutDate | date }}</small></span>
            </div>
            <div class="sidebar-info-right">
              <h4>{{ data?.totalAmount ?  data?.totalAmount : 0}} TK</h4>
            </div>
          </li>
        </ul>
      </div>
    </div>
    <!---end-->
  </div>
  <div class="order-details-container">
    <form [formGroup]="dataForm">
      <div class="order-id-area">
        <h4>#{{ order?.orderId }}</h4>
        <span>{{order?.checkoutDate | date: "short"}}</span>
      </div>

      <!---order-details-main-area-->
      <div class="order-details-main">
        <!---order-details-left-->
        <div class="order-details-left">
          <!---order-details-table-area-->
          <div class="table-head-left">
            <ul>
              <li>
                <span [class]="clickActive[0] ? 'menu-active' : ''" (click)="getOrderDetails()">Order Details</span>
              </li>
              <li>
                <span [class]="clickActive[1] ? 'menu-active' : ''"
                  (click)="getInvoicesByOrderNo()">Invoices(100)</span>
              </li>
              <li>
                <span [class]="clickActive[2] ? 'menu-active' : ''" (click)="getReturns()">Return(100)</span>
              </li>
            </ul>
          </div>
          <div class="table-head-right">
            <span class="edit"><i class="fa fa-edit" [routerLink]="['../../', 'edit-order', order?._id]"></i></span>
            <a style="margin-right:10px" nz-button nzType="primary" [disabled]="selectedIds?.length < 1"
              (click)="openDialog()" type="button">
              Invoice
            </a>
            <nz-select style="margin-right:10px" ngModel="selected" [nzDisabled]="!selectedIds?.length"
              formControlName="selected">
              <nz-option *ngFor="let data of productOrderStatus" [nzLabel]="data.viewValue" [nzValue]="data.value">
              </nz-option>
            </nz-select>
            <input style="margin-right:10px" nz-input type="text" formControlName="statusNote"
              placeholder="Write a note " />
            <button style="margin-right:10px" nz-button nzType="primary" (click)="onOrderStatusChange()">Send</button>
          </div>
          <!---table-end-->
          <nz-table class="table" #columnTable [nzData]="products">
            <thead>
              <tr>
                <th nzLeft nzWidth="25px" class="check">
                  <mat-checkbox></mat-checkbox>
                </th>
                <th nzLeft nzWidth="25px">Image</th>
                <th>Item Name</th>
                <th nzWidth="100px">Price</th>
                <th>Discount (-)</th>
                <th>Tax (+)</th>
                <th>Total</th>
                <th>Advance</th>
                <th nzWidth="100px">Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of columnTable.data; let i=index">
                <td nzWidth="25px" nzLeft>
                  <mat-checkbox (change)="onCheckChange($event, i)"></mat-checkbox>
                </td>
                <td nzLeft>
                  <img nz-image width="50px" [nzSrc]="
                      data.product
                        ? setThumbnailImage(data.product)
                        : '/assets/images/placeholder/test.png'
                    " [alt]="data.product.name" />
                </td>
                <td>
                  <a target="_blank" [routerLink]="['../../../', 'product-details', data.product.slug]" class="text">
                    {{ data?.product.name }}
                  </a>
                  {{ data?.sku }}
                </td>
                <td>
                  {{ data?.quantity }} X {{ data?.price }}
                </td>
                <td>0</td>
                <td>
                  {{ data.tax ? data.tax : "0" }}
                </td>
                <td>
                  {{ getAmount(data) }}
                </td>
                <td>
                  <span [style]="order.paymentStatus !== 1 ? 'color:green' : 'color:orange'">{{ data?.advance }}</span>
                </td>
                <td>
                  <mat-form-field style="width: 100px" appearance="outline">
                    <mat-select [(value)]="data.status" (selectionChange)="onStatusChange($event.value, order, data)">
                      <mat-option  *ngFor="let option of productOrderStatus" [value]="option.value">{{option.viewValue}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </td>
              </tr>
            </tbody>
          </nz-table>
          <!---order-payment-details-->
          <div class="order-pay-details">
            <!--payment-summery-area-->
            <div class="payment-summery-area">
              <div class="total-area">
                <ul>
                  <li>
                    <div class="total-title">
                      <h3>Sub Total</h3>
                    </div>
                    <div class="total-price">
                      <h4>{{ 0 - 120 }} TK</h4>
                    </div>
                  </li>
                  <li>
                    <div class="total-title">
                      <h3>Coupon Code</h3>
                    </div>
                    <div class="total-price">
                      <h4 class="color-red">(-) 0 TK</h4>
                    </div>
                  </li>
                  <li>
                    <div class="total-title">
                      <h3>Points Redeem</h3>
                    </div>
                    <div class="total-price">
                      <h4 class="color-red">
                        (-){{ 0 }} PTS
                      </h4>
                    </div>
                  </li>
                  <li>
                    <div class="total-title">
                      <h3>Shipping Charge</h3>
                    </div>
                    <div class="total-price">
                      <h4>120 TK</h4>
                    </div>
                  </li>
                  <hr />
                  <li>
                    <div class="total-title">
                      <h3>Amount to pay</h3>
                    </div>
                    <div class="total-price">
                      <h4>
                        {{0}}
                        TK
                      </h4>
                    </div>
                  </li>
                  <li>
                    <div class="total-title">
                      <h3>Paid</h3>
                    </div>
                    <div class="total-price">
                      <h4 class="color-red">(-) {{ 0 }}TK</h4>
                    </div>
                  </li>
                  <li>
                    <div class="total-title">
                      <h3>Adjustment</h3>
                    </div>
                    <div class="total-price">
                      <h4 class="color-red">(-) 0 TK</h4>
                    </div>
                  </li>
                  <hr />
                  <li>
                    <div class="total-title">
                      <h3>Due Amount</h3>
                    </div>
                    <div class="total-price">
                      <h4>{{ 0 }} TK</h4>
                    </div>
                  </li>
                  <li>
                    <div class="total-title">
                      <!--                          <p>Cancelled (SKU:{{getCancelSKU()}})</p>-->
                      <!--                          <p >(-) &nbsp;{{calculateCancelTotal()}}TK</p>-->
                      <h3>Cancelled(SKU:{{ getCancelSKU() }})</h3>
                    </div>
                    <div class="total-price">
                      <h4 class="color-red">
                        (-) {{ calculateCancelTotal() }} TK
                      </h4>
                    </div>
                  </li>
                  <hr />
                  <li>
                    <div class="total-title">
                      <h3>Refundable Amount</h3>
                    </div>
                    <div class="total-price">
                      <h4 class="color-red">- 0 TK</h4>
                    </div>
                  </li>
                  <li>
                    <div class="total-title">
                      <h3>Refund(SKU:676ds7)</h3>
                    </div>
                    <div class="total-price">
                      <h4>(-) 0 TK</h4>
                    </div>
                  </li>
                  <hr />
                  <li>
                    <div class="total-title">
                      <h3>Total Due =</h3>
                    </div>
                    <div class="total-price">
                      <h4>{{calculateCancelTotal()}}</h4>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
            <!--payment-summery-area-end-->
          </div>
          <!---order-payment-details-end-->

          <!---customer-msg-->
          <!-- <div class="customer-msg">
            <h3>Message From Customer</h3>
            <p>{{order?.orderNotes}}</p>
          </div> -->

          <!---time-line--->
          <div class="time-line-area">
            <div class="time-line-title">
              <h3>Timeline</h3>
            </div>
            <div class="timeline-main">
              <ng-container *ngIf="
                  order &&
                  order?.orderStatusTimeline &&
                  order?.orderStatusTimeline.length
                ">
                <ul *ngFor="let data of timelineStatus.reverse(); let i = index">
                  <li>
                    <div class="time-check">
                      <span><i class="fa fa-check"></i></span>
                    </div>
                    <div class="timeline-info">
                      <h3>{{ data?.status }}</h3>
                      <p>Status: {{ data?.sku }} product {{ data?.status }}</p>
                      <p class="date">{{ data?.dateTime | date: "medium" }}</p>
                      <h4>{{ data?.statusNote }}</h4>
                    </div>
                  </li>
                </ul>

                <ul>
                  <li>
                    <div class="time-check">
                      <span><i class="fa fa-check"></i></span>
                    </div>
                    <div class="timeline-info">
                      <h3>{{ "Pending" }}</h3>
                      <p>
                        Thank you for placing for your order at Care me. We will
                        start processing your order after payment is complete -
                        Care me
                      </p>
                      <p class="date">
                        {{ order?.checkoutDate | date: "medium" }}
                      </p>
                      <h4>{{ data?.statusNote }}</h4>
                    </div>
                  </li>
                </ul>
              </ng-container>
              <ng-container *ngIf="order && order?.orderStatusTimeline.length === 0">
                <ul>
                  <li>
                    <div class="time-check">
                      <span class="active-check"><i class="fa fa-check"></i></span>
                    </div>
                    <div class="timeline-info">
                      <h3>{{ "Pending" }}</h3>
                      <p>
                        Thank you for placing for your order at Care me. We will
                        start processing your order after payment is complete -
                        Care me
                      </p>
                      <p class="date">
                        {{ order?.checkoutDate | date: "medium" }}
                      </p>
                      <h4>{{ data?.statusNote }}</h4>
                    </div>
                  </li>
                </ul>
              </ng-container>
            </div>
          </div>
        </div>

        <!---order-details-left-end-->
        <!---order-details-right-->
        <div class="order-details-right">
          <!---delivery-info-->
          <div class="delivery-info">
            <!--customer-title-->
            <div class="customer-title">
              <h3>Delivery Info</h3>
            </div>
            <!--customer-title-end-->
            <!---delivery-data-->
            <div class="delivery-data">
              <ul>
                <li>
                  <div>
                    <h3>Shipped By:</h3>
                  </div>
                  <div>
                    <span>Pathao</span>
                  </div>
                </li>
                <li>
                  <div>
                    <h3>Weight:</h3>
                  </div>
                  <div>
                    <span>2kg</span>
                  </div>
                </li>
                <li>
                  <div>
                    <h3>Cost:</h3>
                  </div>
                  <div>
                    <span>700 TK</span>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <!---delivery-info-end-->

          <!---customer-info-->
          <div class="customer-info-area">
            <!--customer-title-->
            <div class="customer-title">
              <h3>Customer Info</h3>
            </div>
            <!--customer-title-end-->
            <!---customer-info--->
            <div class="customer-info">
              <ul>
                <li>
                  <div class="customer-info-left">
                    <h3>Name:</h3>
                  </div>
                  <div class="customer-info-right">
                    <h4>
                      {{ order?.name }}
                    </h4>
                  </div>
                </li>
                <li>
                  <div class="customer-info-left">
                    <h3>Phone No:</h3>
                  </div>
                  <div class="customer-info-right">
                    <h4>
                      {{order?.phoneNo}}
                    </h4>
                  </div>
                </li>
                <li>
                  <div class="customer-info-left">
                    <h3>Email:</h3>
                  </div>
                  <div class="customer-info-right">
                    <a href="#">{{ order?.email }}</a>
                  </div>
                </li>
                <li>
                  <div class="customer-info-left">
                    <h3>Shipping Address:</h3>
                  </div>
                  <div class="customer-info-right">
                    <h3>{{ order?.shippingAddress }}</h3>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <!---customer-info-end-->

          <!---comment-->
          <div class="customer-comment">
            <div class="customer-title">
              <h3>Comments</h3>
            </div>
            <div class="customer-comment-main">
              <mat-form-field class="form-field" appearance="overlay">
                <textarea rows="5" formControlName="comment" [(ngModel)]="commentEmpty" matInput
                  placeholder="..."></textarea>
              </mat-form-field>
            </div>
            <button (click)="addNewComment()">Add</button>
          </div>
          <!---comment-end-->

          <!---order-confirm-status-->
          <div class="order-confirm-status">
            <!---status-info-->
            <div class="status-info"></div>
            <!---status-info-end-->
            <!---status-info-->
            <div class="status-info" *ngFor="let c of order?.comments.reverse(); let i = index">
              <!--status-check-->
              <div class="status-check" *ngIf="i === 0">
                <span class="active-status"><i class="fa fa-check"></i></span>
              </div>
              <div class="status-check" *ngIf="i !== 0">
                <span><i class="fa fa-check"></i></span>
              </div>
              <!--status-type-->
              <div class="status-type">
                <p class="admin_name">{{ admin?.name }}</p>
                <p class="admin_massage">{{ c }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!---order-details-main-area-end-->
    </form>
  </div>
</div>
