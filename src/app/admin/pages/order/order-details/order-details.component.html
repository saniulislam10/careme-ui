<!-- order-header-area-->
<div class="page-header">
  <h2>Sales Order <span (click)="onRefresh()"><i [class]="spin ? 'fa fa-refresh fa-spin': 'fa fa-refresh'"></i></span></h2>
  <div class="header-action">
    <button type="button">Export</button>
    <button type="button">Import</button>

    <button class="create_btn" (click)="openDialog2()">Create Order</button>
  </div>
</div>

<div class="table-samary">
  <nz-card nzSize="small">
    <nz-layout class="main-layout" style="min-height: 50vh">
      <nz-sider class="left_navbar">
        <div class="inner_nav_header">
          <div class="header_action">
            <a nz-dropdown [nzDropdownMenu]="statusMenu">
              All Order <i class="las la-angle-down"></i>
              <nz-dropdown-menu #statusMenu="nzDropdownMenu">
                <ul nz-menu nzSelectable>
                  <li nz-menu-item>COD</li>
                  <li nz-menu-item>Paid</li>
                  <li nz-menu-item>Unpaid</li>
                  <li nz-menu-item>Partial Paid</li>
                  <li nz-menu-item>Invoiced</li>
                  <li nz-menu-item>Partial Invoiced</li>
                </ul>
              </nz-dropdown-menu>
            </a>

            <nz-button-group>
              <button
                nz-button
                nz-dropdown
                [nzDropdownMenu]="actionMenu"
                nzPlacement="bottomRight"
              >
                <span nz-icon nzType="ellipsis"></span>
              </button>
              <nz-dropdown-menu #actionMenu="nzDropdownMenu">
                <ul nz-menu nzSelectable>
                  <li nz-menu-item>Delete</li>
                  <li nz-menu-item>Pending</li>
                  <li nz-menu-item>Reject</li>
                </ul>
              </nz-dropdown-menu>
            </nz-button-group>
          </div>
          <input nz-input placeholder="Basic usage" />
        </div>
        <ul class="refund_list" nz-menu nzTheme="light" nzMode="inline">
          <li
            nz-menu-item
            *ngFor="let data of orders"
            [routerLink]="['../../', 'order-details', data._id]"
          >
            <div class="left">
              <h4>{{ data?.orderId }}</h4>
              <h5>{{ data?.checkoutDate | date: "short" }}</h5>
            </div>
            <div class="right">
              <h4>Pending</h4>
              <h5>{{ data?.totalAmount ? data?.totalAmount : 0 }} TK</h5>
            </div>
          </li>
        </ul>
      </nz-sider>
      <nz-content class="refund_body_main" style="background: #fff">
        <div class="refund_details_header">
          <h4>{{ order?.orderId }}</h4>
          <h5>{{ order?.checkoutDate | date: "short" }}</h5>
        </div>
        <nz-tabset [nzTabBarExtraContent]="extraTemplate">
          <nz-tab
            *ngFor="let tab of bodyTabs"
            [nzTitle]="tab.name"
            [nzDisabled]="tab.disabled"
          >
            <div class="refund_details_body">
              <div nz-row [nzGutter]="16">
                <div nz-col [nzXs]="{ span: 24 }" [nzLg]="{ span: 8 }">
                  <h2>Order Details</h2>
                  <table>
                    <tbody>
                      <tr>
                        <td>Shipped by</td>
                        <td>:</td>
                        <td>Pathao</td>
                      </tr>
                      <tr>
                        <td>Weight</td>
                        <td>:</td>
                        <td>2 KG</td>
                      </tr>
                      <tr>
                        <td>Cost</td>
                        <td>:</td>
                        <td><b>120 TK</b></td>
                      </tr>
                      <tr>
                        <td>Paid by</td>
                        <td>:</td>
                        <td>bKash(01917658452)</td>
                      </tr>
                      <tr>
                        <td>Note</td>
                        <td>:</td>
                        <td>
                          Sunday office hour er moddhe amar product ta delivery
                          dewar try korben. Thank you.
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <div nz-col [nzXs]="{ span: 24 }" [nzLg]="{ span: 16 }">
                  <div nz-row [nzGutter]="0">
                    <div nz-col [nzXs]="{ span: 24 }" [nzLg]="{ span: 16 }">
                      <h2>Delivery Details</h2>
                      <table>
                        <tbody>
                          <tr>
                            <td>Name</td>
                            <td>:</td>
                            <td>{{order.name}}</td>
                          </tr>
                          <tr>
                            <td>Phone No</td>
                            <td>:</td>
                            <td>
                              {{order.shippingPhoneNo}} <i class="las la-lg la-sms"></i>
                            </td>
                          </tr>
                          <tr>
                            <td>Shipping to</td>
                            <td>:</td>
                            <td>
                              {{order.shippingAddress}}
                            </td>
                          </tr>
                        </tbody>
                      </table>
                      <h2>Customer Details</h2>
                      <table class="customer_details">
                        <tbody>
                          <tr>
                            <td>Name</td>
                            <td>:</td>
                            <td>
                              <a href="#">
                                {{order.userId.fullName}}
                                <i class="las la-medal"></i>
                              </a>
                            </td>
                          </tr>
                          <tr>
                            <td>Phone No</td>
                            <td>:</td>
                            <td>{{order.userId.phoneNo}}</td>
                          </tr>
                          <tr>
                            <td>Email</td>
                            <td>:</td>
                            <td>{{order.userId.email}}</td>
                          </tr>
                          <tr>
                            <td>Shipping to</td>
                            <td>:</td>
                            <td>
                              {{order.userId.address}}
                            </td>
                          </tr>
                          <tr>
                            <td>Total Orders</td>
                            <td>:</td>
                            <td>
                              <span class="total-order"> {{order.userId.checkouts.length}} </span>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <div nz-col [nzXs]="{ span: 24 }" [nzLg]="{ span: 8 }">
                      <div class="customadmin_note">
                        <div class="text_area">
                          <textarea
                            rows="2"
                            nz-input
                            [(ngModel)]="inputValue"
                            placeholder="this comment only for admin ..."
                          ></textarea>
                          <button nz-button nzType="default" (click)="addNewComment()">
                            Add Comment
                          </button>
                        </div>
                        <div class="timeline timeline-items">
                          <nz-timeline class="timeline">
                            <nz-timeline-item *ngFor="let comment of order.comments.reverse()">
                              <p>{{comment.text}}</p>
                              <span>{{comment.date | date:'short'}} by {{comment.name}}</span>
                            </nz-timeline-item>
                          </nz-timeline>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <nz-card class="refund_details_body-product" nzSize="small">
                <nz-table
                  #rowSelectProduct
                  [nzFrontPagination]="false"
                  [nzData]="products"
                  [nzLoading]="loading"
                  (nzCurrentPageDataChange)="onCurrentPageDataChange($event)"
                >
                  <thead>
                    <tr>
                      <th
                        [(nzChecked)]="allSelected"
                        [nzIndeterminate]="indeterminate"
                        (nzCheckedChange)="onAllCheck($event)"
                      ></th>
                      <th>Image</th>
                      <th>Item Details</th>
                      <th>Qty</th>
                      <th>Price</th>
                      <th>Tax (+)</th>
                      <th>Discount (-)</th>
                      <th>Total</th>
                      <th>Advance</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr
                      *ngFor="let data of rowSelectProduct.data; let i = index"
                    >
                      <td
                        [nzChecked]="setOfCheckedId.has(data._id)"
                        (nzCheckedChange)="onCheckChange($event, i, data._id)"
                      ></td>
                      <td>
                        <img
                          nz-image
                          width="50px"
                          [nzSrc]="
                            data.productId
                              ? setThumbnailImage(data.productId)
                              : '/assets/images/placeholder/test.png'
                          "
                          [alt]="data.productId.name"
                        />
                      </td>
                      <td>
                        {{ data.name }}
                        {{ data.sku }}
                      </td>
                      <td>
                        {{ data.quantity }}
                        <div class="inv-qty">
                          INV-{{ data?.invoicedQuantity }}
                        </div>
                        <div class="rto-qty">
                          RTO-{{ data?.returnedQuantity }}
                        </div>
                      </td>
                      <td>{{ data.price }}</td>
                      <td>{{ data.tax ? data.tax : "0" }}</td>
                      <td>0</td>
                      <td>{{ getAmount(data) }}</td>
                      <td>
                        <p
                          [style]="
                            order.paymentStatus === 1
                              ? 'color:orange'
                              : 'color:green'
                          "
                        >
                          {{ data.advanceAmount }}
                        </p>
                      </td>
                      <td>
                        <a
                          class="btn confirm"
                          nz-dropdown
                          [nzDropdownMenu]="itemStatus"
                          nzTrigger="click"
                        >
                          Confirmed <i class="las la-angle-down"></i>
                        </a>
                        <nz-dropdown-menu #itemStatus="nzDropdownMenu">
                          <ul nz-menu nzSelectable>
                            <li nz-menu-item>Cancel</li>
                            <li nz-menu-item>Confirmed</li>
                            <li nz-menu-item [nzDisabled]="true">Shipped</li>
                            <li nz-menu-item [nzDisabled]="true">Delivered</li>
                          </ul>
                        </nz-dropdown-menu>
                      </td>
                    </tr>
                  </tbody>
                </nz-table>
                <div nz-row [nzGutter]="0">
                  <div nz-col [nzXs]="{ span: 24 }" [nzLg]="{ span: 24 }">
                    <nz-card nzSize="small" class="ammount_summary">
                      <div class="ammount_summary_single">
                        <h4><b>Sub-Total</b></h4>
                        <span><b>{{order.totalAmount - order.shippingCharge}} TK</b></span>
                      </div>
                      <div class="ammount_summary_single" *ngIf="order.couponCode">
                        <h4 class="cuppon" >
                          Coupon Code
                          <span><i class="las la-lg la-tag"></i>{{order.couponCode}}</span>
                        </h4>
                        <span style="color: red">- 0.00 TK</span>
                      </div>
                      <div class="ammount_summary_single" *ngIf="order.redeemedPoints">
                        <h4>Points Redeem</h4>
                        <span style="color: red">{{order.redeemedPoints}}TK</span>
                      </div>
                      <div class="ammount_summary_single">
                        <h4>Shipping</h4>
                        <span>{{order.shippingCharge}} TK</span>
                      </div>
                      <nz-divider
                        style="margin: 10px 0"
                        nzType="horizontal"
                      ></nz-divider>
                      <div class="ammount_summary_single">
                        <h4></h4>
                        <span> Amount to pay = <b>{{order.totalAmount}} TK</b></span>
                      </div>
                      <div class="ammount_summary_single mt15">
                        <h4>Paid</h4>
                        <span style="color: green">{{order.paidAmount}} TK</span>
                      </div>
                      <div class="ammount_summary_single mt15" *ngIf="order.adjustmentAmount">
                        <h4>Adjustment</h4>
                        <span style="color: red">{{order.adjustmentAmount}} TK</span>
                      </div>
                      <nz-divider
                        style="margin: 10px 0"
                        nzType="horizontal"
                      ></nz-divider>
                      <div class="ammount_summary_single">
                        <h4></h4>
                        <span> Due Amount = {{order.totalAmount - order.paidAmount}} TK</span>
                      </div>
                      <div class="ammount_summary_single mt15" *ngIf="order.canceledAmount">
                        <h4>Cancelled (SKU: 5045844)</h4>
                        <span style="color: red">0.00 TK</span>
                      </div>
                      <nz-divider
                        style="margin: 10px 0"
                        nzType="horizontal"
                      ></nz-divider>
                      <div class="ammount_summary_single" *ngIf="order.canceledAmount">
                        <h4></h4>
                        <span style="color: red">
                          Refundable Amount = 0.00 TK</span
                        >
                      </div>
                      <div class="ammount_summary_single mt15" *ngIf="order.canceledAmount">
                        <h4>Refund (SKU: 5045844)</h4>
                        <span style="color: red">0.00 TK</span>
                      </div>
                      <nz-divider
                        style="margin: 10px 0"
                        nzType="horizontal"
                        *ngIf="order.canceledAmount"
                      ></nz-divider>
                      <div class="ammount_summary_single" *ngIf="order.canceledAmount">
                        <h4></h4>
                        <span> Due Amount = 0 TK</span>
                      </div>
                    </nz-card>
                  </div>
                </div>
                <div class="customer_time_line">
                  <nz-collapse nzGhost>
                    <nz-collapse-panel nzHeader="Add Comment" nzActive="false">
                      <textarea rows="2" nz-input></textarea>
                      <button nz-button nzType="default">Send Message</button>
                    </nz-collapse-panel>
                  </nz-collapse>

                  <div class="timeline_record">
                    <nz-timeline class="timeline_record_list" nzMode="left">
                      <nz-timeline-item [nzDot]="successTem" nzColor="green">
                        <h4 class="title">Confirmed!</h4>
                        <p class="bodytext">
                          Thank you for placing for your order at Care me. We
                          will start processing your order after payment is
                          complete
                        </p>
                        <span class="linetime">
                          05 Jul 2022 05:51 PM by Omee
                        </span>
                      </nz-timeline-item>
                      <nz-timeline-item [nzDot]="cancleTemp" nzColor="red">
                        <h4 class="title">Cancelled!</h4>
                        <p class="bodytext">
                          Thank you for placing for your order at Care me. We
                          will start processing your order after payment is
                          complete
                        </p>
                        <span class="linetime">
                          05 Jul 2022 05:51 PM by Omee
                        </span>
                      </nz-timeline-item>
                      <nz-timeline-item [nzDot]="successTem" nzColor="green">
                        <h4 class="title">Pending!</h4>
                        <p class="bodytext">
                          Thank you for placing for your order at Care me. We
                          will start processing your order after payment is
                          complete
                        </p>
                        <span class="linetime">
                          05 Jul 2022 05:51 PM by Omee
                        </span>
                      </nz-timeline-item>
                    </nz-timeline>
                    <a class="showmore" nz-button nzType="text">
                      Show More <i class="las la-angle-down"></i>
                    </a>
                    <ng-template #successTem>
                      <i class="lar la-2x la-check-circle"></i>
                    </ng-template>
                    <ng-template #cancleTemp>
                      <i class="lar la-2x la-times-circle"></i>
                    </ng-template>
                  </div>
                </div>
              </nz-card>
            </div>
          </nz-tab>
        </nz-tabset>
        <ng-template #extraTemplate>
          <button nz-button [routerLink]="['../../', 'edit-order', order?._id]">
            <i class="lar la-edit"></i>
          </button>
          <button nz-button (click)="openDialog()">
            <i class="las la-file-invoice"></i>
          </button>
        </ng-template>
      </nz-content>
    </nz-layout>
  </nz-card>
</div>
